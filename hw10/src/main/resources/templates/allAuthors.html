<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Authors</title>
  <style type="text/css">
  .authors td {
              border: 10px solid blue;
          }
</style>
</head>
<body>
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<div class="container" style="min-height: 500px">

    <div class="starter-template">
        <h1>Authors Form</h1>

        <div id="feedback"></div>

        <form class="form-horizontal" id="add-form">
            <div class="form-group form-group-lg">
                <label class="col-sm-2 control-label">Id</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="authorid"/>
                </div>
            </div>

            <div class="form-group form-group-lg">
            <label class="col-sm-2 control-label">Author</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="authorname"/>
            </div>
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" id="btn-add"
                            class="btn btn-primary btn-lg">add
                    </button>
                </div>
            </div>
        </form>

    </div>

    <table id="authors" border="5" bgcolor="#add8e6">
    <thead>
    <tr>
    <td>ID</td>
    <td>Name</td>
    </tr>
</thead>
<tbody>

</tbody>


</table>

</div>

<script>
$(document).ready(function () {

    $("#add-form").submit(function (event) {

event.preventDefault();

        fire_ajax_submit();

    });

})
function fire_ajax_submit() {

    var author = {
        authorid: $("#authorid").val(),
        authorname : $("#authorname").val()
    }

    $("#btn-add").prop("disabled", true);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/authors",
        data: JSON.stringify(author),
        dataType: 'json',
        cache: false,
        timeout: 600000,
        success: function (data) {
            console.log("SUCCESS : ", data);
            showAllAuthors();
            $("#btn-add").prop("disabled", false);
        }
    })

}

    function showAllAuthors() {
            $.get("/authors").done(function (authors) {
                $("#authors tbody").empty();
                authors.forEach(function (author) {
                    $("#authors tbody").append(`
                        <tr>
                            <td>${author.authorid}</td>
                            <td>${author.authorname}</td>
                            <td><button style=" color: green" onclick="editAuthor(${author.authorid})" >Edit</button></td>
                            <td><button style=" color: red"  onclick="deleteAuthor(${author.authorid})">Delete</button></td>

                                       </tr>
                    `)
                });
            })
        }

        function deleteAuthor(id) {
                $.ajax({
                    url: "/authors/" + id,
                    method: "DELETE",
                           success: function() {
                               showAllAuthors();
                           },
                           error: function (error) {
                               alert(error);
                           }
                       })
         }

         function editAuthor(authorid) {
           alert("You are editing author with id - " + ( authorid ));
           var t = document.getElementById('authors');
           var name = ($(t.rows[authorid].cells[1]).text());
           var newauthorname = window.prompt("Change name", name);

            var editedauthor = {
                authorid: authorid,
                authorname : newauthorname
            };

        $(t.rows[authorid].cells[1]).html(editedauthor.authorname);
           $.ajax({
               url:"/authors/"+ authorid,
               method:"PUT",
               data: JSON.stringify(editedauthor),
               dataType: "json",
               contentType: "application/json",
               success:   function(){
                   console.log("SUCCESS : ", data);
                   alert("succesfully updated to "+ data.authorname);
                   showAllAuthors();
               }

            })

         }
</script>
</body>
</html>