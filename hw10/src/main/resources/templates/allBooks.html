<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>books</title>
  <style type="text/css">
  .books td {
              border: 10px solid blue;
          }
</style>
</head>
<body>
<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<div class="container" style="min-height: 500px">
<form class="form-horizontal" id="add-form">
            <div class="form-group form-group-lg">
                <label class="col-sm-2 control-label">Book ID</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="id"/>
                </div>
            </div>

            <div class="form-group form-group-lg">
            <label class="col-sm-2 control-label">Book Name</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="name"/>
            </div>
            </div>


            <div class="form-group form-group-lg">
                <label class="col-sm-2 control-label">Author ID</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="authorid"/>
                </div>
            </div>

            <div class="form-group form-group-lg">
            <label class="col-sm-2 control-label">Genre ID</label>
            <div class="col-sm-10">
            <input type="text" class="form-control" id="genrerid"/>
            </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" id="btn-add"
                            class="btn btn-primary btn-lg">add
                    </button>
                </div>
            </div>
        </form>
    <table id="books" border="5" bgcolor="#add8e6">
    <thead>
    <tr>
    <td>ID</td>
    <td>Name</td>
    </tr>
</thead>
<tbody>

</tbody>


</table>


</div>

<script>
$(document).ready(function () {

    $("#add-form").submit(function (event) {

event.preventDefault();

        fire_ajax_submit();

    });

})
function fire_ajax_submit() {

    var book = {
        id: $("#id").val(),
        name : $("#name").val(),
        authorId : $("#authorid").val(),
        genreId : $("#genreid").val()
    }

    $("#btn-add").prop("disabled", true);

    $.ajax({
        type: "POST",
        contentType: "application/json",
        url: "/books",
        data: JSON.stringify(book),
        dataType: 'json',
        cache: false,
        timeout: 600000,
        success: function (data) {
            console.log("SUCCESS : ", data);
            showAllbooks();
            $("#btn-add").prop("disabled", false);
        }
    })

}

    function showAllbooks() {
            $.get("/books").done(function (books) {
                $("#books tbody").empty();
                books.forEach(function (book) {
                    $("#books tbody").append(`
                        <tr>
                            <td>${book.id}</td>
                            <td>${book.name}</td>
                            <td><button style=" color: green" onclick="editbook(${book.id})" >Edit</button></td>
                            <td><button style=" color: red"  onclick="deletebook(${book.id})">Delete</button></td>

                                       </tr>
                    `)
                });
            })
        }

        function deletebook(id) {
                $.ajax({
                    url: "/books/" + id,
                    method: "DELETE",
                           success: function() {
                               showAllbooks();
                           },
                           error: function (error) {
                               alert(error);
                           }
                       })
         }

         function editbook(id) {
           alert("You are editing book with id - " + ( id ));
           var t = document.getElementById('books');
           var name = ($(t.rows[id].cells[1]).text());
           var newname = window.prompt("Change name", name);

            var editedbook = {
                id: id,
                name : newname
            };

        $(t.rows[id].cells[1]).html(editedbook.name);
           $.ajax({
               url:"/books/"+ id,
               method:"PUT",
               data: JSON.stringify(editedbook),
               dataType: "json",
               contentType: "application/json",
               success:   function(){
                   console.log("SUCCESS : ", data);
                   alert("succesfully updated to "+ data.name);
                   showAllbooks();
               }

            })

         }
</script>
</body>
</html>